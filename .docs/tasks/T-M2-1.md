# T-M2-1: useConversation カスタムフックの実装

| 項目 | 内容 |
|------|------|
| マイルストーン | M2 |
| 依存 | T-M1-2, T-M1-3, T-M1-4 |
| 要件ID | FR-001, FR-002, FR-003 |

## 説明
会話の状態管理を一元化するカスタムフックを実装する。メッセージの送信・受信・状態更新・永続化をこのフックに集約し、UI コンポーネントからはこのフックのみを利用する。

## 作業内容
1. `src/hooks/useConversation.ts` を作成
2. フックの状態を定義:
   - `messages: Message[]` - 会話メッセージ配列
   - `isLoading: boolean` - API 応答待ち状態
3. 初期化処理を実装:
   - マウント時に `loadMessages("default")` で LocalStorage から復元
4. `sendMessage()` 関数を実装:
   - ユーザーメッセージを Message 型で生成
   - `const nextMessages = [...currentMessages, userMessage]` で新しい配列を作成（React の非同期 state 更新を考慮し、ローカル変数で確定した配列を以降の処理で一貫して使用する）
   - nextMessages で state を更新し、isLoading を true に設定
   - `createChatCompletion()` に nextMessages を渡して API 呼び出し
   - 応答を assistant Message として生成し、`const finalMessages = [...nextMessages, assistantMessage]` で配列を作成
   - finalMessages で state を更新し、isLoading を false に設定
   - `saveMessages()` に finalMessages を渡して永続化
5. フックの戻り値を定義:
   - messages, isLoading, sendMessage, clearMessages

## タスクのチェックリスト
- [ ] マウント時に LocalStorage から会話が復元される
- [ ] sendMessage() でユーザーメッセージが即座に messages に追加される
- [ ] API 呼び出し中は isLoading が true になる
- [ ] API 応答が assistant メッセージとして追加される
- [ ] 送信完了後に LocalStorage へ保存される

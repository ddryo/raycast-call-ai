# T-M5-2: デフォルトシステムプロンプト（Preferences）の実装

| 項目 | 内容 |
|------|------|
| マイルストーン | M5 |
| 依存 | T-M5-1 |
| 要件ID | FR-013 |

## 説明
Preferences にデフォルトのシステムプロンプト設定を追加し、全会話の送信時にシステムプロンプトを先頭注入する仕組みを実装する。

## 作業内容
1. `package.json` の `preferences` セクションに `systemPrompt` を追加:
   - `name`: "systemPrompt"
   - `type`: "textfield"
   - `required`: false
   - `title`: "System Prompt"
   - `description`: "デフォルトのシステムプロンプト（全会話で送信時に適用されます）"
   - `placeholder`: "例: あなたは親切なアシスタントです。日本語で回答してください。"
2. `src/hooks/useConversation.ts` の `sendMessage()` を修正:
   - 送信前に Preferences から `systemPrompt` を取得
   - trim 後が空でなければ、`role: "system"` のメッセージを会話履歴の先頭に一時的に注入
   - 注入は API 送信時のみ（`trimMessagesForContext()` の呼び出し前に配列へ追加し、トークン上限計算に含める）
   - LocalStorage の会話履歴にはシステムプロンプトを保存しない
3. 既存の `openai.ts` の system -> instructions 変換ロジックがそのまま活用されることを確認

## 設計上の注意
- システムプロンプトは LocalStorage には保存しない（送信時に都度注入のみ）
- 空文字 / 空白のみのプロンプトは「未設定」扱い（trim 後が空なら注入しない）
- 後続の T-M5-5 でカスタムコマンドのプロンプトが優先される仕組みに拡張される

## タスクのチェックリスト
- [ ] Preferences にシステムプロンプト設定が表示される
- [ ] システムプロンプトが設定されている場合、API 送信時に先頭注入される
- [ ] システムプロンプトが空の場合、注入されない
- [ ] システムプロンプトは LocalStorage の会話履歴に保存されない
- [ ] `openai.ts` の instructions 変換が正しく動作する
- [ ] 既存の会話機能に影響がない

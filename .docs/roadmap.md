# 実装ロードマップ

## マイルストーン構成

| マイルストーン | 内容 |
|----------|------|
| M1 | プロジェクト初期セットアップ |
| M2 | コア機能実装（単一会話チャット） |
| M3 | UX 強化・仕上げ |
| M4 | 複数スレッド管理 |


## M1: プロジェクト初期セットアップ

| タスクID | 状態 | 依存タスク | 対応要件 | 概要 |
|----------|------|-----------|----------|------|
| T-M1-1 | ✅ | - | - | Raycast 拡張機能プロジェクトの初期化と基本設定 |
| T-M1-2 | ✅ | T-M1-1 | - | 型定義の作成（Message, Thread, エラー型） |
| T-M1-3 | ✅ | T-M1-1 | - | OpenAI API 通信層の実装 |
| T-M1-4 | ✅ | T-M1-1 | - | LocalStorage 永続化層の実装 |

### マイルストーン達成条件
- [x] `npm run dev` でエラーなくビルドが通る
- [x] 型定義・API通信層・永続化層が個別モジュールとして存在する
- [x] Preferences に API キーを設定できる


## M2: コア機能実装（単一会話チャット）

| タスクID | 状態 | 依存タスク | 対応要件 | 概要 |
|----------|------|-----------|----------|------|
| T-M2-1 | ✅ | T-M1-2, T-M1-3, T-M1-4 | FR-001, FR-002, FR-003 | useConversation カスタムフックの実装 |
| T-M2-2 | ✅ | T-M2-1 | FR-001, FR-002 | メインコマンド UI の実装（List + Detail + SearchBar 入力） |
| T-M2-3 | ✅ | T-M2-2 | FR-004 | 会話の永続化統合（起動時復元・送信後保存） |
| T-M2-4 | ✅ | T-M2-2 | FR-005 | 複数行入力フォームの実装（ActionPanel 経由） |

### マイルストーン達成条件
- [x] SearchBar からメッセージを送信し、AI の応答が表示される
- [x] 会話履歴が List に時系列で表示される
- [x] 選択メッセージの内容が Detail（markdown）に表示される
- [x] 拡張機能を再起動しても会話が復元される
- [x] 複数行テキストを Form から入力・送信できる


## M3: UX 強化・仕上げ

| タスクID | 状態 | 依存タスク | 対応要件 | 概要 |
|----------|------|-----------|----------|------|
| T-M3-1 | ✅ | T-M2-2 | FR-006 | エラーハンドリングの実装（401/429/タイムアウト/ネットワーク断） |
| T-M3-2 | ✅ | T-M2-2 | FR-007 | 二重送信防止の実装（isLoading 制御） |
| T-M3-3 | ✅ | T-M2-3 | FR-008 | 会話クリア機能の実装 |
| T-M3-4 | ✅ | T-M2-2 | FR-009 | メッセージコピー機能の実装 |

### マイルストーン達成条件
- [x] API エラー時に種別に応じた適切な Toast メッセージが表示される
- [x] 送信中は入力がロックされ、ローディング表示がされる
- [x] 会話履歴を全クリアできる
- [x] 選択メッセージをクリップボードにコピーできる
- [x] Phase 1 の全機能が安定して動作する


## M4: 複数スレッド管理

| タスクID | 状態 | 依存タスク | 対応要件 | 概要 |
|----------|------|-----------|----------|------|
| T-M4-1 | ✅ | T-M3-3 | FR-010 | スレッド作成・切替機能の実装 |
| T-M4-2 | ✅ | T-M4-1 | FR-011 | スレッド一覧表示の実装 |
| T-M4-3 | ✅ | T-M4-1 | FR-010 | スレッド削除機能の実装 |
| T-M4-4 | ⬜ | T-M4-1 | FR-012 | 履歴上限管理の実装（トークン超過時の切り捨て） |

### マイルストーン達成条件
- [ ] 新しいスレッドを作成して会話を開始できる
- [x] スレッド一覧から過去の会話を選択して再開できる
- [x] 不要なスレッドを削除できる
- [ ] トークン上限を超える長い会話でもエラーにならない

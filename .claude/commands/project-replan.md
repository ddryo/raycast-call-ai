# Project Replan - プロジェクト再計画

プロジェクトを進めた段階で全貌が見えてきた際に、既存のドキュメント（仕様書・ロードマップ）を見直し、再整理するコマンド。

## 引数

- `$ARGUMENTS`: ユーザーの追加指示・要望

## 前提条件

- 既存の計画ドキュメントが存在すること:
  - `.docs/spec.md`
  - `.docs/roadmap.md`


## 実行手順

TodoWrite ツールで以下のフェーズを管理してください:

- [ ] Phase 0: 現状把握
- [ ] Phase 1: ドキュメント更新
- [ ] Phase 2: Codex レビュー

### Phase 0: 現状把握とモード選択

以下のドキュメントを読み込んで現状を把握:

1. **既存計画ドキュメント**:
   - `.docs/spec.md`
   - `.docs/roadmap.md`
   - `.docs/tasks/*.md`（存在する場合）

2. **TODO.md の確認**:
   - `TODO.md` が存在すれば読み込む
   - 追加要望やユーザーからのメモを把握

3. **ユーザーの指示を確認**:
   - ユーザーの追加要望（`$ARGUMENTS`）

4. **実装状況の確認**:
   - `src/` や主要なソースディレクトリを確認
   - 既存の実装コードの構造を把握

5. **進捗状況の確認**:
   - roadmap.md から完了済みタスク（✅）を抽出
   - 進行中タスク（🔄）を抽出
   - 未着手タスク（⬜）を抽出

6. **ユーザーへの報告**:

```
## 現状分析
- [現在の進捗状況]
- [課題・問題点]

## 見直しの方針
- [要件/仕様/ロードマップで見直すべきポイント]
```

7. **モード選択** (AskUserQuestion):


| モード | 目的 | 適したケース |
|--------|------|--------------|
| **update** | 追記・部分修正 | 小さな変更、新要件の追加、バグフィックスなど |
| **restructure** | ゼロベース再構成 | 方針転換、大幅な見直し、構造の刷新 |


```
どのモードで見直しますか？

1. update（追記・部分修正）
2. restructure（ゼロベースで再構成）
3. 中止する
```

選択結果を `MODE` 変数として以降のフェーズで使用する。


8. **方向性の確認** (`MODE = restructure`の時のみ)

新たにプロジェクトの機能要件・非機能要件を整理し、重要となるポイントを先に列挙し、方向性を確認します。

```markdown
## 重要ポイント（案）

1. [ポイント]
2. [ポイント]
...
```

情報が不足していたり、不明点があればユーザーに質問・確認し、プロジェクトの方向性をこの初期段階でしっかり見定めること。

9. **Codex と相談**

重要ポイントが整理できたら、一度 codex を呼び出して相談します。

以下のコマンドを使い、このプロジェクトの要件を伝えてあなたが作成した重要リストで問題がなさそうか相談してください。

```bash
codex exec --sandbox read-only '
## プロジェクト概要
{現在のプロジェクト概要を記載}

## 現状の課題
{ユーザーの要望と現状の課題を記載}

## 重要ポイント（案）
{整理した重要ポイントを記載}

上記の重要ポイントについて、不足している観点や考慮すべき点があれば教えてください。
'
```

> **Note**: `codex exec` の引数にはシングルクォートで囲んだプロンプトを渡します。複数行の場合もそのまま記述できます。

Codex の返答も踏まえて重要ポイントが整理できたら、一度ユーザーに見せて確認します。

ユーザーの確認が取れたら、次のフェーズへ進んでください。


### Phase 1: ドキュメント更新

Task ツールで サブエージェント `document-editor` を呼び出し、以下のプロンプトを実行させてください。

**Phase 0 の文脈を明示的に渡し、spec → roadmap → task を一括で更新/再構築します。**

MODE に応じて action を指定:
- update モード → `action=update`
- restructure モード → `action=restructure`

```
## ドキュメントの更新/再構築

### 考慮すべき事項
{Phase 0 で把握した TODO.md の内容、追加要望、進捗状況、重要ポイントを記載}

### 背景・補足
{Phase 0 での議論で得られた追加の文脈があれば記載}

---

以下を順に実行してください:
1. /docs-spec action={MODE}
2. /docs-roadmap action={MODE}
3. /docs-task action={MODE}

## 重要: 完了タスクの保持
- ✅ 完了済みタスクはそのまま保持
- 🔄 進行中タスクは状態を維持
- ⬜ 未着手タスクは見直し対象
```

サブエージェントの作業完了後、以下が更新されていることを確認:
- `.docs/spec.md`
- `.docs/roadmap.md`
- `.docs/tasks/*.md`


### Phase 2: Codex レビュー

全ドキュメントの更新が完了したら、最後にまとめてレビューを実行:

```
/codex-review
```

レビューで指摘があれば修正し、`ok: true` になるまで反復する。


## 成果報告

以下のフォーマットで、各フェーズが完了したことを報告して終了します。

```
## 更新されたドキュメント
- `.docs/spec.md` - プロジェクト仕様書
- `.docs/roadmap.md` - ロードマップ
- `.docs/tasks/` - タスクの詳細

## 次のステップ

実装を継続するには:
/project-autopilot
```

## エラー時の対応

各フェーズでエラーが発生した場合:

1. エラー内容をユーザーに報告
2. 解決方法があれば提案
3. 続行/中止を確認

